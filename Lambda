trigger: none

schedules:
  - cron: "*/5 * * * *"   # run every 5 minutes (UTC)
    displayName: "Test Market Selector"
    always: true
    branches:
      include:
        - cron/aqa-ui-mcom-app-test-dev   # change to your default branch

stages:
- stage: TestMarket
  jobs:
  - job: PrintMarket
    steps:
      # Step 1: Select market based on current minute (modulo 7 rotation)
      - script: |
          MINUTE=$(date -u +"%M")
          echo "UTC Minute is $MINUTE"

          # Compute index (0â€“6) based on 5-minute slot
          INDEX=$(( (10#$MINUTE / 5) % 7 ))

          MARKETS=("kuwait" "united_arab_emirates" "saudi_arabia" "egypt" "qatar" "bahrain" "jordan")
          market=${MARKETS[$INDEX]}

          echo "Market selected: $market"

          # Export market as pipeline variable (for later steps)
          echo "##vso[task.setvariable variable=market]$market"
        displayName: "Select and Save Market"

      # Step 2: Print the selected market again
      - script: |
          echo "Pipeline variable market is: $(market)"
        displayName: "Print Saved Market"
