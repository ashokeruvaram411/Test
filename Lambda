trigger: none

schedules:
  - cron: "*/5 * * * *"   # run every 5 minutes (UTC)
    displayName: "Test Market Selector"
    always: true
    branches:
      include:
        - main   # change to your default branch

stages:
- stage: TestMarket
  jobs:
  - job: PrintMarket
    steps:
      # Step 1: Select market based on current minute
      - script: |
          MINUTE=$(date -u +"%M")
          echo "UTC Minute is $MINUTE"

          case $((MINUTE % 7)) in
            0) market="kuwait" ;;
            1) market="united_arab_emirates" ;;
            2) market="saudi_arabia" ;;
            3) market="egypt" ;;
            4) market="qatar" ;;
            5) market="bahrain" ;;
            6) market="jordan" ;;
          esac

          echo "Market selected: $market"

          # Export market as pipeline variable (lowercase)
          echo "##vso[task.setvariable variable=market]$market"
        displayName: "Select and Save Market"

      # Step 2: Print the selected market again
      - script: |
          echo "Pipeline variable market is: $(market)"
        displayName: "Print Saved Market"
